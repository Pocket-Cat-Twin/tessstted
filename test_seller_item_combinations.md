# –¢–ï–°–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ô –õ–û–ì–ò–ö–ò –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê –°–í–Ø–ó–û–ö –ü–†–û–î–ê–í–ï–¶-–¢–û–í–ê–†

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û 1: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—á–µ–∑–Ω—É–≤—à–∏—Ö —Å–≤—è–∑–æ–∫
**–ü—Ä–æ–±–ª–µ–º–∞:** removed_combinations –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–æ –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞–ª–∏—Å—å  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω –∫–æ–¥ –≤ `_detect_combination_changes`:
```python
# Log removed combinations as ITEM_REMOVED
for seller, item in removed_combinations:
    change = ChangeLogEntry(
        seller_name=seller,
        item_name=item,
        change_type='ITEM_REMOVED',
        old_value=f"{seller}/{item}",
        new_value=None
    )
    
    # Log to changes_log table + Update status to UNCHECKED
```

### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û 2: –ú–µ—Ç–æ–¥ remove_inactive_combinations
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–ª–æ–Ω–∫–∏ `last_seen_at`  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏:
```python
# –ë–´–õ–û (—Å–ª–æ–º–∞–Ω–æ):
WHERE (last_seen_at IS NULL AND created_at < ?) OR last_seen_at < ?

# –°–¢–ê–õ–û (—Ä–∞–±–æ—Ç–∞–µ—Ç):  
WHERE status = 'UNCHECKED' AND status_changed_at < ?
```

### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û 3: UPDATE –∑–∞–ø—Ä–æ—Å—ã —Å last_seen_at
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ø—ã—Ç–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ–ª–æ–Ω–∫—É  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –£–±—Ä–∞–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ `last_seen_at` –∏–∑ UPDATE –∑–∞–ø—Ä–æ—Å–æ–≤

## –î–ï–¢–ê–õ–¨–ù–´–ô –¢–ï–°–¢-–ö–ï–ô–°

### –°—Ü–µ–Ω–∞—Ä–∏–π: –ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —Å–≤—è–∑–∫–∏ –ü–†–û–î–ê–í–ï–¶-–¢–û–í–ê–†

#### –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–¥–µ–Ω—å 1):
```
monitoring_queue:
- (–ü—Ä–æ–¥–∞–≤–µ—Ü123, –¢–æ–≤–∞—Ä–ê) -> —Å—Ç–∞—Ç—É—Å: CHECKED, status_changed_at: 2025-09-01 10:00
- (–ü—Ä–æ–¥–∞–≤–µ—Ü456, –¢–æ–≤–∞—Ä–ë) -> —Å—Ç–∞—Ç—É—Å: CHECKED, status_changed_at: 2025-09-01 10:00
- (–ü—Ä–æ–¥–∞–≤–µ—Ü789, –¢–æ–≤–∞—Ä–í) -> —Å—Ç–∞—Ç—É—Å: CHECKED, status_changed_at: 2025-09-01 10:00

sellers_current:
- (–ü—Ä–æ–¥–∞–≤–µ—Ü123, –¢–æ–≤–∞—Ä–ê) -> —Å—Ç–∞—Ç—É—Å: CHECKED
- (–ü—Ä–æ–¥–∞–≤–µ—Ü456, –¢–æ–≤–∞—Ä–ë) -> —Å—Ç–∞—Ç—É—Å: CHECKED  
- (–ü—Ä–æ–¥–∞–≤–µ—Ü789, –¢–æ–≤–∞—Ä–í) -> —Å—Ç–∞—Ç—É—Å: CHECKED
```

#### –î–µ–Ω—å 2: –ù–æ–≤—ã–π OCR —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ü—Ä–æ–¥–∞–≤–µ—Ü789 –∏—Å—á–µ–∑)
```
–ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
current_combinations = {
    (–ü—Ä–æ–¥–∞–≤–µ—Ü123, –¢–æ–≤–∞—Ä–ê),  
    (–ü—Ä–æ–¥–∞–≤–µ—Ü456, –¢–æ–≤–∞—Ä–ë)
    # –ü—Ä–æ–¥–∞–≤–µ—Ü789 –±–æ–ª—å—à–µ –ù–ï–¢!
}

previous_combinations = {
    (–ü—Ä–æ–¥–∞–≤–µ—Ü123, –¢–æ–≤–∞—Ä–ê),
    (–ü—Ä–æ–¥–∞–≤–µ—Ü456, –¢–æ–≤–∞—Ä–ë),
    (–ü—Ä–æ–¥–∞–≤–µ—Ü789, –¢–æ–≤–∞—Ä–í)
}
```

#### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ _detect_combination_changes:
```python
removed_combinations = previous - current = {(–ü—Ä–æ–¥–∞–≤–µ—Ü789, –¢–æ–≤–∞—Ä–í)}

# –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê (—Ä–∞–Ω—å—à–µ –ù–ï —Ä–∞–±–æ—Ç–∞–ª–æ):
for seller, item in removed_combinations:
    # 1. –õ–æ–≥–∏—Ä—É–µ–º –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ
    INSERT INTO changes_log 
    VALUES ('–ü—Ä–æ–¥–∞–≤–µ—Ü789', '–¢–æ–≤–∞—Ä–í', 'ITEM_REMOVED', '–ü—Ä–æ–¥–∞–≤–µ—Ü789/–¢–æ–≤–∞—Ä–í', NULL)
    
    # 2. –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ UNCHECKED
    UPDATE monitoring_queue 
    SET status = 'UNCHECKED', status_changed_at = CURRENT_TIMESTAMP
    WHERE seller_name = '–ü—Ä–æ–¥–∞–≤–µ—Ü789' AND item_name = '–¢–æ–≤–∞—Ä–í'
    
    # 3. –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º sellers_current
    UPDATE sellers_current 
    SET status = 'UNCHECKED', status_changed_at = CURRENT_TIMESTAMP
    WHERE seller_name = '–ü—Ä–æ–¥–∞–≤–µ—Ü789' AND item_name = '–¢–æ–≤–∞—Ä–í'
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏:
```
changes_log:
+ –ù–û–í–ê–Ø –ó–ê–ü–ò–°–¨: (–ü—Ä–æ–¥–∞–≤–µ—Ü789, –¢–æ–≤–∞—Ä–í, ITEM_REMOVED, –ü—Ä–æ–¥–∞–≤–µ—Ü789/–¢–æ–≤–∞—Ä–í, NULL, 2025-09-02 10:30)

monitoring_queue:
- (–ü—Ä–æ–¥–∞–≤–µ—Ü123, –¢–æ–≤–∞—Ä–ê) -> —Å—Ç–∞—Ç—É—Å: CHECKED
- (–ü—Ä–æ–¥–∞–≤–µ—Ü456, –¢–æ–≤–∞—Ä–ë) -> —Å—Ç–∞—Ç—É—Å: CHECKED
- (–ü—Ä–æ–¥–∞–≤–µ—Ü789, –¢–æ–≤–∞—Ä–í) -> —Å—Ç–∞—Ç—É—Å: UNCHECKED ‚úÖ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –û–ë–ù–û–í–õ–ï–ù–û!

sellers_current:
- (–ü—Ä–æ–¥–∞–≤–µ—Ü123, –¢–æ–≤–∞—Ä–ê) -> —Å—Ç–∞—Ç—É—Å: CHECKED
- (–ü—Ä–æ–¥–∞–≤–µ—Ü456, –¢–æ–≤–∞—Ä–ë) -> —Å—Ç–∞—Ç—É—Å: CHECKED
- (–ü—Ä–æ–¥–∞–≤–µ—Ü789, –¢–æ–≤–∞—Ä–í) -> —Å—Ç–∞—Ç—É—Å: UNCHECKED ‚úÖ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –û–ë–ù–û–í–õ–ï–ù–û!
```

#### –î–µ–Ω—å 9: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ (remove_inactive_combinations)
```
inactive_threshold_days = 7
cutoff_date = 2025-09-02 (7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥)

‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –∑–∞–ø—Ä–æ—Å:
SELECT seller_name, item_name FROM monitoring_queue
WHERE status = 'UNCHECKED' AND status_changed_at < '2025-09-02'

–ù–∞–π–¥–µ–Ω–æ: (–ü—Ä–æ–¥–∞–≤–µ—Ü789, –¢–æ–≤–∞—Ä–í) - UNCHECKED —Å 2025-09-02 10:30

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ –ª–æ–≥–∏—Ä–æ–≤–∞–ª–æ—Å—å –ª–∏ —É–∂–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–¥–∞–≤–Ω–æ
SELECT COUNT(*) FROM changes_log 
WHERE seller_name = '–ü—Ä–æ–¥–∞–≤–µ—Ü789' AND item_name = '–¢–æ–≤–∞—Ä–í' 
AND change_type = 'ITEM_REMOVED' AND detected_at > '2025-09-02'

# –ï—Å–ª–∏ —É–∂–µ –ª–æ–≥–∏—Ä–æ–≤–∞–ª–æ—Å—å - –Ω–µ –¥—É–±–ª–∏—Ä—É–µ–º, –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª—è–µ–º

# –£–¥–∞–ª—è–µ–º –∏–∑ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü:
DELETE FROM monitoring_queue WHERE status = 'UNCHECKED' AND status_changed_at < cutoff
DELETE FROM sellers_current WHERE status = 'UNCHECKED' AND status_changed_at < cutoff
```

#### –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
```
monitoring_queue:
- (–ü—Ä–æ–¥–∞–≤–µ—Ü123, –¢–æ–≤–∞—Ä–ê) -> —Å—Ç–∞—Ç—É—Å: CHECKED
- (–ü—Ä–æ–¥–∞–≤–µ—Ü456, –¢–æ–≤–∞—Ä–ë) -> —Å—Ç–∞—Ç—É—Å: CHECKED
# (–ü—Ä–æ–¥–∞–≤–µ—Ü789, –¢–æ–≤–∞—Ä–í) - –£–î–ê–õ–ï–ù–û ‚úÖ

sellers_current:
- (–ü—Ä–æ–¥–∞–≤–µ—Ü123, –¢–æ–≤–∞—Ä–ê) -> —Å—Ç–∞—Ç—É—Å: CHECKED
- (–ü—Ä–æ–¥–∞–≤–µ—Ü456, –¢–æ–≤–∞—Ä–ë) -> —Å—Ç–∞—Ç—É—Å: CHECKED
# (–ü—Ä–æ–¥–∞–≤–µ—Ü789, –¢–æ–≤–∞—Ä–í) - –£–î–ê–õ–ï–ù–û ‚úÖ

changes_log —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é:
- (–ü—Ä–æ–¥–∞–≤–µ—Ü789, –¢–æ–≤–∞—Ä–í, ITEM_REMOVED, ..., 2025-09-02 10:30) ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–æ!
```

## –ü–†–û–í–ï–†–ö–ê EDGE CASES

### Edge Case 1: –í—Ä–µ–º–µ–Ω–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—Ç
```
–î–µ–Ω—å 1: (–ü—Ä–æ–¥–∞–≤–µ—ÜX, –¢–æ–≤–∞—ÄY) -> CHECKED
–î–µ–Ω—å 2: –ò—Å—á–µ–∑ -> UNCHECKED + ITEM_REMOVED –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–æ  
–î–µ–Ω—å 3: –ü–æ—è–≤–∏–ª—Å—è —Å–Ω–æ–≤–∞ -> NEW + NEW_ITEM –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–æ
```

### Edge Case 2: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
```
removed_combinations = {(–ü1, –¢1), (–ü2, –¢2), (–ü3, –¢3)}

‚úÖ –í–°–ï –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ —Ü–∏–∫–ª–µ:
- 3 –∑–∞–ø–∏—Å–∏ ITEM_REMOVED –≤ changes_log
- 3 –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ UNCHECKED
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–π —Å–≤—è–∑–∫–∏
```

### Edge Case 3: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–æ–≤
```
if not already_logged:  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—É–±–ª–∏
    INSERT INTO changes_log (ITEM_REMOVED)
# –ò–∑–±–µ–≥–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ
```

## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –†–ê–ë–û–¢–ê–Æ–¢ –ö–û–†–†–ï–ö–¢–ù–û

**–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
1. **–î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —Å–≤—è–∑–æ–∫** –∏ –ª–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∫ `ITEM_REMOVED`
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –∏—Å—á–µ–∑–Ω—É–≤—à–∏–µ —Å–≤—è–∑–∫–∏ –≤ UNCHECKED** 
3. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ UNCHECKED —Å–≤—è–∑–∫–∏** —á–µ—Ä–µ–∑ N –¥–Ω–µ–π
4. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –ë–î**
5. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤**

### üéØ –ö–û–ù–¶–ï–ü–¶–ò–Ø –°–í–Ø–ó–û–ö –°–û–ë–õ–Æ–î–ê–ï–¢–°–Ø

–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã (NEW/CHECKED/UNCHECKED) –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–¥–µ—Ç–µ–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ) –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∏–º–µ–Ω–Ω–æ –∫ **—Å–≤—è–∑–∫–∞–º –ü–†–û–î–ê–í–ï–¶-–¢–û–í–ê–†**, –∞ –Ω–µ –∫ –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø—Ä–æ–¥–∞–≤—Ü–∞–º –∏–ª–∏ —Ç–æ–≤–∞—Ä–∞–º.

**–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–≤—è–∑–æ–∫!**